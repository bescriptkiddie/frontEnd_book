## 问卷编辑器设计

### 背景

设计一款仿问卷网调问编辑器，包含单选、多选、下拉、填空、矩阵等，配置完成后支持移动端`H5`展示、`PC`端展示

### 方案

#### 1.基于 gitHub 上开源调问插件

- [form-render](https://github.com/alibaba/form-render)

阿里开源，支持`Antd`
实现原理: 通过 `JSON Schema` 生成标准 `Form，`常用于自定义搭建配置界面生成.
优点：`UI`组件界面友好，任意组合各类型组件、生成表单
缺点：控件依赖`Antd`组件，加入矩阵评分题型、或备注题型支持不了，可扩展性差

- [DWSurvey](https://github.com/wkeyuan/DWSurvey)
  `DWSurvey`是一款方便、高效、实用的调研问卷系统，一款基于 `JAVA WEB`的开源问卷表单系统。
  优点：基本满足调问系统基本使用，支持控件丰富
  缺点：前后端不分离、没有前端开发文档、可扩展性未知

#### 2.组件封装

实现原理：使用`JSON`维护问卷配置,对一个`JSON`数据源分别编译成移动端和 pc 端页面
优点：扩展性强，个性化能力强、增加一个控件只需添加一个组件，样式可控
缺点：没有生成静态文件、依赖`json`数据源，针对`h5`、`pc`端分别编写编译组件,由于多端部分逻辑差异性，校验逻辑不能复用，存在重复代码、需要进行抽象。

## 实现

![avatar](/assets/basic.png)
![avatar](/assets/app_basic.png)
代码实现：

```js
// config.js

export const getQuestionStem = (surveyId: string | undefined, editors: EditorItemProps[], type: string) => {
  const editorObj = {
    belongId: surveyId || '',
    copyFromId: '',
    hv: 0,
    quId: uuidv4(),
    isRequired: 1,
    keywords: '',
    orderById: getOrderById(editors),
    quName: getEditorTitle(type),
    quNote: '',
    quTitle: '',
    quType: type,
    questionLogics: [],
    tag: 0,
    visibility: 1,
    showState: 1,
    quTag: 1,
    isLogicShow: 1,
  };
  ...
  return editorObj;
}
```

组件通信设计
![avatar](/assets/content.png)
